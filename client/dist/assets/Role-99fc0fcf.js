import{_ as se}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                *//* empty css                   *//* empty css                       *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                 */import{G as i,K as E,c as ne,H as re,r as ie,o as P,a as de,b as k,d as t,w as l,L as ue,M as pe,J as me,N as ce,O as fe,a0 as ge,P as _e,Q as ve,R as ye,f as n,I as be,S as ke,T as S,U as we,V as he,h as Ce,W as Ve,X as Re,_ as xe,$ as Ee,a5 as Te}from"./index-25be2468.js";import{r as _}from"./request-b9763afa.js";const De=d=>_({url:"/roles",method:"get",params:d}),ze=d=>_({url:`/roles/${d}`,method:"get"}),Ue=d=>_({url:"/roles",method:"post",data:d}),$e=(d,v)=>_({url:`/roles/${d}`,method:"put",data:v}),Be=d=>_({url:`/roles/${d}`,method:"delete"}),Ke=()=>_({url:"/menus/tree",method:"get"});const Pe={class:"role-management"},Se={class:"search-form"},Ie={class:"button-group"},Me={class:"table-container"},Le={class:"operation-buttons"},Fe={class:"pagination"},Ne={__name:"Role",setup(d){const v=i(!1),T=i([]),D=i([]),c=i(!1),y=i(!1),h=i(!1),C=i(!1),w=i(),V=i(),b=E({keyword:""}),r=E({page:1,limit:10,total:0}),s=E({id:null,name:"",code:"",description:"",status:1}),z=i(null),R=i([]),I={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色代码",trigger:"blur"}]},M=ne(()=>s.id?"编辑角色":"新增角色"),f=async()=>{v.value=!0;try{const o={page:r.page,limit:r.limit,keyword:b.keyword},e=await De(o);T.value=e.data,r.total=e.total}catch(o){console.error("加载数据失败:",o)}finally{v.value=!1}},L=async()=>{try{const o=await Ke();D.value=o}catch(o){console.error("加载菜单树失败:",o)}},x=()=>{r.page=1,f()},F=()=>{b.keyword="",x()},N=()=>{Object.assign(s,{id:null,name:"",code:"",description:"",status:1}),c.value=!0},j=o=>{Object.assign(s,{id:o.id,name:o.name,code:o.code,description:o.description,status:o.status}),c.value=!0},q=async o=>{try{await ke.confirm("确定要删除该角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Be(o.id),S.success("删除成功"),f()}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},O=async o=>{z.value=o.id;try{const e=await ze(o.id);R.value=e.permissions?e.permissions.map(p=>p.menu_id):[],y.value=!0}catch(e){console.error("获取角色权限失败:",e)}},G=async()=>{if(w.value)try{await w.value.validate(),h.value=!0,s.id?await $e(s.id,s):await Ue(s),c.value=!1,f()}catch(o){console.error("提交失败:",o)}finally{h.value=!1}},H=async()=>{try{C.value=!0;const o=V.value.getCheckedKeys(),e=V.value.getHalfCheckedKeys(),p=[...o,...e];S.success("权限设置成功"),y.value=!1}catch(o){console.error("设置权限失败:",o)}finally{C.value=!1}},A=()=>{var o;(o=w.value)==null||o.resetFields()},J=()=>{z.value=null,R.value=[]},Q=o=>{r.limit=o,f()},W=o=>{r.page=o,f()};return re(()=>{f(),L()}),(o,e)=>{const p=we,g=he,u=me,U=ce,X=ie("Plus"),Y=Ce,m=Ve,Z=Re,ee=fe,te=ge,$=xe,oe=Ee,B=_e,le=Te,ae=ve;return P(),de("div",Pe,[k("div",Se,[t(U,{model:b,inline:""},{default:l(()=>[t(g,{label:"关键词"},{default:l(()=>[t(p,{modelValue:b.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>b.keyword=a),placeholder:"请输入角色名称或代码",clearable:"",onKeyup:ye(x,["enter"])},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(u,{type:"primary",onClick:x},{default:l(()=>[...e[11]||(e[11]=[n("搜索",-1)])]),_:1}),t(u,{onClick:F},{default:l(()=>[...e[12]||(e[12]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),k("div",Ie,[t(u,{type:"primary",onClick:N},{default:l(()=>[t(Y,null,{default:l(()=>[t(X)]),_:1}),e[13]||(e[13]=n(" 新增角色 ",-1))]),_:1})]),k("div",Me,[ue((P(),pe(ee,{data:T.value,stripe:"",border:"","table-layout":"fixed"},{default:l(()=>[t(m,{prop:"id",label:"ID",width:"80","show-overflow-tooltip":""}),t(m,{prop:"name",label:"角色名称",width:"150","show-overflow-tooltip":""}),t(m,{prop:"code",label:"角色代码",width:"120","show-overflow-tooltip":""}),t(m,{prop:"description",label:"描述","min-width":"200"}),t(m,{prop:"status",label:"状态",width:"100","show-overflow-tooltip":""},{default:l(({row:a})=>[t(Z,{type:a.status===1?"success":"danger"},{default:l(()=>[n(be(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"created_at",label:"创建时间",width:"180","show-overflow-tooltip":""}),t(m,{label:"操作",width:"280","show-overflow-tooltipfixed":"right"},{default:l(({row:a})=>[k("div",Le,[t(u,{size:"small",onClick:K=>j(a)},{default:l(()=>[...e[14]||(e[14]=[n("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"primary",onClick:K=>O(a)},{default:l(()=>[...e[15]||(e[15]=[n(" 权限设置 ",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"danger",onClick:K=>q(a)},{default:l(()=>[...e[16]||(e[16]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ae,v.value]]),k("div",Fe,[t(te,{"current-page":r.page,"onUpdate:currentPage":e[1]||(e[1]=a=>r.page=a),"page-size":r.limit,"onUpdate:pageSize":e[2]||(e[2]=a=>r.limit=a),total:r.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),t(B,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a),title:M.value,width:"600px",onClose:A},{footer:l(()=>[t(u,{onClick:e[7]||(e[7]=a=>c.value=!1)},{default:l(()=>[...e[19]||(e[19]=[n("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:G,loading:h.value},{default:l(()=>[...e[20]||(e[20]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(U,{ref_key:"formRef",ref:w,model:s,rules:I,"label-width":"100px"},{default:l(()=>[t(g,{label:"角色名称",prop:"name"},{default:l(()=>[t(p,{modelValue:s.name,"onUpdate:modelValue":e[3]||(e[3]=a=>s.name=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"角色代码",prop:"code"},{default:l(()=>[t(p,{modelValue:s.code,"onUpdate:modelValue":e[4]||(e[4]=a=>s.code=a),placeholder:"请输入角色代码"},null,8,["modelValue"])]),_:1}),t(g,{label:"描述",prop:"description"},{default:l(()=>[t(p,{modelValue:s.description,"onUpdate:modelValue":e[5]||(e[5]=a=>s.description=a),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),t(g,{label:"状态",prop:"status"},{default:l(()=>[t(oe,{modelValue:s.status,"onUpdate:modelValue":e[6]||(e[6]=a=>s.status=a)},{default:l(()=>[t($,{label:1},{default:l(()=>[...e[17]||(e[17]=[n("启用",-1)])]),_:1}),t($,{label:0},{default:l(()=>[...e[18]||(e[18]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(B,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=a=>y.value=a),title:"权限设置",width:"800px",onClose:J},{footer:l(()=>[t(u,{onClick:e[9]||(e[9]=a=>y.value=!1)},{default:l(()=>[...e[21]||(e[21]=[n("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:H,loading:C.value},{default:l(()=>[...e[22]||(e[22]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(le,{ref_key:"permissionTreeRef",ref:V,data:D.value,props:{label:"name",children:"children"},"show-checkbox":"","node-key":"id","default-checked-keys":R.value,"check-strictly":""},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"])])}}},Ze=se(Ne,[["__scopeId","data-v-e00d74ed"]]);export{Ze as default};
