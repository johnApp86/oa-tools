import{_ as ne}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                   *//* empty css                       *//* empty css                  *//* empty css                     *//* empty css                      *//* empty css                 */import{G as m,K as k,c as se,H as ie,r as re,o as c,a as E,b,d as a,w as n,L as B,M as V,T as g,J as de,N as ue,O as pe,a0 as me,P as ce,Q as ge,R as _e,f as u,I as fe,a1 as $,a2 as F,S as be,U as ve,V as ye,h as he,W as Ve,X as we,a3 as ze,_ as Ce,$ as Ie,a4 as ke}from"./index-4e5dc47e.js";const Ee={class:"user-management"},Ue={class:"search-form"},Ne={class:"button-group"},xe={class:"table-container"},Te={class:"operation-buttons"},Se={class:"pagination"},je={class:"dialog-footer"},Pe={__name:"User",setup(De){const w=m(!1),U=m([]),_=m(!1),z=m(!1),y=m(),N=m([]),h=m([]),v=k({keyword:""}),r=k({page:1,limit:10,total:0}),l=k({id:null,username:"",realName:"",email:"",phone:"",organizationId:null,positionId:null,status:1}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名至少3位",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","change"]}],organizationId:[{required:!0,message:"请选择所属组织",trigger:"change"}],positionId:[{required:!0,message:"请选择所属岗位",trigger:"change"}]},q=se(()=>l.id?"编辑用户":"新增用户"),f=async()=>{w.value=!0;try{const t={page:r.page,limit:r.limit,keyword:v.keyword},s=await(await fetch(`/api/users?${new URLSearchParams(t)}`)).json();U.value=s.data,r.total=s.total}catch(t){console.error("加载数据失败:",t),g.error("加载数据失败")}finally{w.value=!1}},C=()=>{r.page=1,f()},M=()=>{v.keyword="",C()},x=async()=>{try{const[t,e]=await Promise.all([fetch("/api/organizations/all"),fetch("/api/positions")]),[s,i]=await Promise.all([t.json(),e.json()]);N.value=s,i.value=i.data||i}catch(t){console.error("加载选项数据失败:",t)}},T=async t=>{try{const s=await(await fetch(`/api/positions?organizationId=${t}`)).json();h.value=s.data||s}catch(e){console.error("加载岗位数据失败:",e)}},J=()=>{I(),_.value=!0,x()},K=t=>{I(),Object.assign(l,{id:t.id,username:t.username,realName:t.real_name,email:t.email,phone:t.phone,organizationId:t.organization_id,positionId:t.position_id,status:t.status}),_.value=!0,x(),t.organization_id&&T(t.organization_id)},G=async t=>{try{await be.confirm(`确定要删除用户 "${t.username}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await fetch(`/api/users/${t.id}`,{method:"DELETE"});if(e.ok)g.success("删除成功"),f();else{const s=await e.json();g.error(s.message||"删除失败")}}catch(e){e!=="cancel"&&(console.error("删除失败:",e),g.error("删除失败"))}},A=async()=>{if(y.value)try{await y.value.validate(),z.value=!0;const t={username:l.username,real_name:l.realName,email:l.email,phone:l.phone,organization_id:l.organizationId,position_id:l.positionId,status:l.status};let e;if(l.id?e=await fetch(`/api/users/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}):e=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),e.ok)g.success(l.id?"更新成功":"创建成功"),_.value=!1,f();else{const s=await e.json();g.error(s.message||"操作失败")}}catch(t){console.error("提交失败:",t),g.error("操作失败")}finally{z.value=!1}},S=()=>{_.value=!1,I()},I=()=>{var t;(t=y.value)==null||t.resetFields(),Object.assign(l,{id:null,username:"",realName:"",email:"",phone:"",organizationId:null,positionId:null,status:1}),h.value=[]},H=t=>{l.positionId=null,t?T(t):h.value=[]},Q=t=>{r.limit=t,f()},W=t=>{r.page=t,f()};return ie(()=>{f()}),(t,e)=>{const s=ve,i=ye,p=de,j=ue,X=re("Plus"),Y=he,d=Ve,Z=we,ee=pe,ae=me,P=ke,D=ze,R=Ce,te=Ie,oe=ce,O=ge;return c(),E("div",Ee,[b("div",Ue,[a(j,{model:v,inline:""},{default:n(()=>[a(i,{label:"关键词"},{default:n(()=>[a(s,{modelValue:v.keyword,"onUpdate:modelValue":e[0]||(e[0]=o=>v.keyword=o),placeholder:"请输入用户名、姓名或邮箱",clearable:"",onKeyup:_e(C,["enter"])},null,8,["modelValue"])]),_:1}),a(i,null,{default:n(()=>[a(p,{type:"primary",onClick:C},{default:n(()=>[...e[11]||(e[11]=[u("搜索",-1)])]),_:1}),a(p,{onClick:M},{default:n(()=>[...e[12]||(e[12]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),b("div",Ne,[a(p,{type:"primary",onClick:J},{default:n(()=>[a(Y,null,{default:n(()=>[a(X)]),_:1}),e[13]||(e[13]=u(" 新增用户 ",-1))]),_:1})]),b("div",xe,[B((c(),V(ee,{data:U.value,border:"",style:{width:"100%"}},{default:n(()=>[a(d,{prop:"id",label:"ID",width:"80"}),a(d,{prop:"username",label:"用户名",width:"120"}),a(d,{prop:"real_name",label:"真实姓名",width:"120"}),a(d,{prop:"email",label:"邮箱",width:"200"}),a(d,{prop:"phone",label:"手机号",width:"120"}),a(d,{prop:"org_name",label:"组织",width:"120"}),a(d,{prop:"position_name",label:"岗位",width:"120"}),a(d,{prop:"status",label:"状态",width:"80"},{default:n(({row:o})=>[a(Z,{type:o.status===1?"success":"danger"},{default:n(()=>[u(fe(o.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"created_at",label:"创建时间",width:"160"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:n(({row:o})=>[b("div",Te,[a(p,{size:"small",onClick:le=>K(o)},{default:n(()=>[...e[14]||(e[14]=[u("编辑",-1)])]),_:1},8,["onClick"]),a(p,{size:"small",type:"danger",onClick:le=>G(o)},{default:n(()=>[...e[15]||(e[15]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[O,w.value]]),b("div",Se,[a(ae,{"current-page":r.page,"onUpdate:currentPage":e[1]||(e[1]=o=>r.page=o),"page-size":r.limit,"onUpdate:pageSize":e[2]||(e[2]=o=>r.limit=o),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),a(oe,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=o=>_.value=o),title:q.value,width:"600px",onClose:S},{footer:n(()=>[b("span",je,[a(p,{onClick:S},{default:n(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),a(p,{type:"primary",onClick:A},{default:n(()=>[...e[19]||(e[19]=[u("确定",-1)])]),_:1})])]),default:n(()=>[B((c(),V(j,{ref_key:"formRef",ref:y,model:l,rules:L,"label-width":"100px"},{default:n(()=>[a(i,{label:"用户名",prop:"username"},{default:n(()=>[a(s,{modelValue:l.username,"onUpdate:modelValue":e[3]||(e[3]=o=>l.username=o),disabled:!!l.id},null,8,["modelValue","disabled"])]),_:1}),a(i,{label:"真实姓名",prop:"realName"},{default:n(()=>[a(s,{modelValue:l.realName,"onUpdate:modelValue":e[4]||(e[4]=o=>l.realName=o)},null,8,["modelValue"])]),_:1}),a(i,{label:"邮箱",prop:"email"},{default:n(()=>[a(s,{modelValue:l.email,"onUpdate:modelValue":e[5]||(e[5]=o=>l.email=o)},null,8,["modelValue"])]),_:1}),a(i,{label:"手机号",prop:"phone"},{default:n(()=>[a(s,{modelValue:l.phone,"onUpdate:modelValue":e[6]||(e[6]=o=>l.phone=o)},null,8,["modelValue"])]),_:1}),a(i,{label:"所属组织",prop:"organizationId"},{default:n(()=>[a(D,{modelValue:l.organizationId,"onUpdate:modelValue":e[7]||(e[7]=o=>l.organizationId=o),placeholder:"请选择组织",style:{width:"100%"},onChange:H},{default:n(()=>[(c(!0),E($,null,F(N.value,o=>(c(),V(P,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"所属岗位",prop:"positionId"},{default:n(()=>[a(D,{modelValue:l.positionId,"onUpdate:modelValue":e[8]||(e[8]=o=>l.positionId=o),placeholder:"请选择岗位",style:{width:"100%"},disabled:!l.organizationId},{default:n(()=>[(c(!0),E($,null,F(h.value,o=>(c(),V(P,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(i,{label:"状态",prop:"status"},{default:n(()=>[a(te,{modelValue:l.status,"onUpdate:modelValue":e[9]||(e[9]=o=>l.status=o)},{default:n(()=>[a(R,{label:1},{default:n(()=>[...e[16]||(e[16]=[u("启用",-1)])]),_:1}),a(R,{label:0},{default:n(()=>[...e[17]||(e[17]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[O,z.value]])]),_:1},8,["modelValue","title"])])}}},Ke=ne(Pe,[["__scopeId","data-v-6db7d8ee"]]);export{Ke as default};
