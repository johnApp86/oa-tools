import{_ as we}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                */import{G as V,c as D,K as L,H as xe,o as T,a as Y,d as t,w as l,T as m,a6 as Ce,P as Le,b as s,g as I,f as r,I as p,a1 as Te,a2 as Ue,L as Z,M,R as Ee,S as ee,h as Se,J as ze,a9 as De,a4 as Ae,a3 as Be,V as Pe,a8 as Fe,N as Ie,W as Me,O as Oe,a0 as Re,a7 as je,U as $e,X as qe,Q as Ne,z as te,x as He}from"./index-25be2468.js";import{i as ae,j as Ke,k as le,l as We}from"./hr-d3c416c7.js";import{g as Ge}from"./user-61247764.js";import"./request-b9763afa.js";const Je={class:"attendance-management"},Qe={class:"tab-content"},Xe={class:"button-group"},Ye={class:"today-status"},Ze={class:"status-info"},et={class:"status-item"},tt={class:"value"},at={class:"status-item"},lt={class:"value"},ot={class:"status-item"},st={class:"value"},nt={class:"search-form"},dt={class:"table-container"},rt={class:"pagination"},it={class:"tab-content"},ut={class:"search-form"},pt={class:"button-group"},ct={class:"leave-stats"},_t={class:"leave-stat-card"},mt={class:"leave-stat-value"},vt={class:"leave-stat-card"},ft={class:"leave-stat-value"},gt={class:"leave-stat-card"},yt={class:"leave-stat-value"},bt={class:"leave-stat-card"},kt={class:"leave-stat-value"},Vt={class:"table-container"},ht={class:"leave-days"},wt=["title"],xt={class:"operation-buttons"},Ct={class:"pagination"},Lt={__name:"Attendance",setup(Tt){const O=V("attendance"),A=V(!1),R=V([]),y=V({}),j=V([]),B=V(!1),x=V([]),C=V(!1),U=D(()=>{const o=x.value.length,e=x.value.filter(g=>g.status===1).length,i=x.value.filter(g=>g.status===2).length,d=x.value.filter(g=>g.status===3).length;return{total:o,pending:e,approved:i,rejected:d}}),v=L({user_id:"",date_start:"",date_end:""}),f=L({keyword:"",type:"",status:""}),b=L({page:1,limit:10,total:0}),k=L({page:1,limit:10,total:0}),c=L({type:"",start_date:"",end_date:"",reason:"",emergency_contact:""}),oe={type:[{required:!0,message:"请选择请假类型",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],reason:[{required:!0,message:"请输入请假原因",trigger:"blur"}]},$=V(),q=D(()=>!!y.value.checkin_time),se=D(()=>!!y.value.checkout_time),ne=D(()=>y.value.checkin_time&&y.value.checkout_time?H(y.value.checkin_time,y.value.checkout_time):0),de=o=>({annual:"年假",sick:"病假",personal:"事假",compensatory:"调休",other:"其他"})[o]||o,re=o=>({1:"info",2:"success",3:"danger"})[o]||"info",ie=o=>({1:"待审核",2:"已通过",3:"已拒绝"})[o]||"待审核",N=o=>o?new Date(o).toLocaleString():"",H=(o,e)=>{if(!o||!e)return 0;const i=new Date(o),g=new Date(e)-i;return Math.round(g/(1e3*60*60)*100)/100},ue=(o,e)=>{if(!o||!e)return 0;const i=new Date(o),d=new Date(e),g=Math.abs(d-i);return Math.ceil(g/(1e3*60*60*24))+1},pe=o=>{o==="attendance"?(h(),E()):o==="leave"&&w()},h=async()=>{A.value=!0;try{const o={page:b.page,limit:b.limit,...v},e=await ae(o);R.value=e.data,b.total=e.total}catch{m.error("加载数据失败")}finally{A.value=!1}},E=async()=>{try{const o=new Date().toISOString().split("T")[0],i=await ae({date_start:o,date_end:o,limit:1});i.data&&i.data.length>0?y.value=i.data[0]:y.value={}}catch(o){console.error("加载今日考勤失败:",o)}},w=async()=>{B.value=!0;try{const o={page:k.page,limit:k.limit,...f},e=await Ke(o);x.value=e.data,k.total=e.total}catch{m.error("加载数据失败")}finally{B.value=!1}},ce=()=>{v.user_id="",v.date_start="",v.date_end="",b.page=1,h()},_e=()=>{f.keyword="",f.type="",f.status="",k.page=1,w()},me=async()=>{try{await ee.prompt("请输入签到地点","签到",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"请输入签到地点"});const o=arguments[0].value||"办公室";await le({user_id:1,type:"checkin",location:o}),m.success("签到成功"),E(),h()}catch(o){o!=="cancel"&&m.error("签到失败")}},ve=async()=>{try{await ee.prompt("请输入签退地点","签退",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"请输入签退地点"});const o=arguments[0].value||"办公室";await le({user_id:1,type:"checkout",location:o}),m.success("签退成功"),E(),h()}catch(o){o!=="cancel"&&m.error("签退失败")}},fe=async()=>{try{await $.value.validate(),await We({...c,user_id:1}),m.success("申请提交成功"),C.value=!1,ge(),w()}catch{m.error("申请提交失败")}},ge=()=>{Object.assign(c,{type:"",start_date:"",end_date:"",reason:"",emergency_contact:""})},ye=o=>{m.info("查看请假详情功能待实现")},K=async(o,e)=>{try{m.success("状态更新成功"),w()}catch{m.error("状态更新失败")}},be=async()=>{try{const o=await Ge();j.value=o.data||o}catch{m.error("加载基础数据失败")}};return xe(()=>{h(),E(),be()}),(o,e)=>{const i=Se,d=ze,g=De,u=Ae,S=Be,_=Pe,z=Fe,P=Ie,n=Me,W=Oe,G=Re,J=je,F=$e,ke=qe,Ve=Ce,he=Le,Q=Ne;return T(),Y("div",Je,[t(Ve,{modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=a=>O.value=a),onTabChange:pe},{default:l(()=>[t(J,{label:"考勤管理",name:"attendance"},{default:l(()=>[s("div",Qe,[s("div",Xe,[t(d,{type:"success",onClick:me,disabled:q.value},{default:l(()=>[t(i,null,{default:l(()=>[t(I(te))]),_:1}),e[19]||(e[19]=r(" 签到 ",-1))]),_:1},8,["disabled"]),t(d,{type:"warning",onClick:ve,disabled:!q.value||se.value},{default:l(()=>[t(i,null,{default:l(()=>[t(I(te))]),_:1}),e[20]||(e[20]=r(" 签退 ",-1))]),_:1},8,["disabled"])]),s("div",Ye,[t(g,null,{header:l(()=>[...e[21]||(e[21]=[s("span",null,"今日考勤状态",-1)])]),default:l(()=>[s("div",Ze,[s("div",et,[e[22]||(e[22]=s("span",{class:"label"},"签到时间：",-1)),s("span",tt,p(y.value.checkin_time||"未签到"),1)]),s("div",at,[e[23]||(e[23]=s("span",{class:"label"},"签退时间：",-1)),s("span",lt,p(y.value.checkout_time||"未签退"),1)]),s("div",ot,[e[24]||(e[24]=s("span",{class:"label"},"工作时长：",-1)),s("span",st,p(ne.value)+"小时",1)])])]),_:1})]),s("div",nt,[t(P,{model:v,inline:""},{default:l(()=>[t(_,{label:"员工"},{default:l(()=>[t(S,{modelValue:v.user_id,"onUpdate:modelValue":e[0]||(e[0]=a=>v.user_id=a),placeholder:"选择员工",clearable:"",style:{width:"200px"},"popper-append-to-body":!1},{default:l(()=>[(T(!0),Y(Te,null,Ue(j.value,a=>(T(),M(u,{key:a.id,label:a.real_name||a.username,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"开始日期"},{default:l(()=>[t(z,{modelValue:v.date_start,"onUpdate:modelValue":e[1]||(e[1]=a=>v.date_start=a),type:"date",placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),t(_,{label:"结束日期"},{default:l(()=>[t(z,{modelValue:v.date_end,"onUpdate:modelValue":e[2]||(e[2]=a=>v.date_end=a),type:"date",placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(d,{type:"primary",onClick:h},{default:l(()=>[...e[25]||(e[25]=[r("搜索",-1)])]),_:1}),t(d,{onClick:ce},{default:l(()=>[...e[26]||(e[26]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",dt,[Z((T(),M(W,{data:R.value,stripe:"",border:"","table-layout":"fixed"},{default:l(()=>[t(n,{prop:"user_name",label:"员工姓名"}),t(n,{prop:"position_name",label:"岗位"}),t(n,{prop:"date",label:"日期"}),t(n,{prop:"checkin_time",label:"签到时间"},{default:l(({row:a})=>[r(p(a.checkin_time?N(a.checkin_time):"未签到"),1)]),_:1}),t(n,{prop:"checkout_time",label:"签退时间"},{default:l(({row:a})=>[r(p(a.checkout_time?N(a.checkout_time):"未签退"),1)]),_:1}),t(n,{label:"工作时长"},{default:l(({row:a})=>[r(p(H(a.checkin_time,a.checkout_time))+"小时 ",1)]),_:1}),t(n,{prop:"checkin_location",label:"签到地点"}),t(n,{prop:"checkout_location",label:"签退地点"})]),_:1},8,["data"])),[[Q,A.value]])]),s("div",rt,[t(G,{"current-page":b.page,"onUpdate:currentPage":e[3]||(e[3]=a=>b.page=a),"page-size":b.limit,"onUpdate:pageSize":e[4]||(e[4]=a=>b.limit=a),total:b.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:h,onCurrentChange:h},null,8,["current-page","page-size","total"])])])]),_:1}),t(J,{label:"请假管理",name:"leave"},{default:l(()=>[s("div",it,[s("div",ut,[t(P,{model:f,inline:""},{default:l(()=>[t(_,{label:"关键词"},{default:l(()=>[t(F,{modelValue:f.keyword,"onUpdate:modelValue":e[5]||(e[5]=a=>f.keyword=a),placeholder:"搜索姓名或邮箱",clearable:"",onKeyup:Ee(w,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{label:"请假类型"},{default:l(()=>[t(S,{modelValue:f.type,"onUpdate:modelValue":e[6]||(e[6]=a=>f.type=a),placeholder:"选择请假类型",clearable:"",style:{width:"200px"},"popper-append-to-body":!1},{default:l(()=>[t(u,{label:"年假",value:"annual"}),t(u,{label:"病假",value:"sick"}),t(u,{label:"事假",value:"personal"}),t(u,{label:"调休",value:"compensatory"}),t(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"状态"},{default:l(()=>[t(S,{modelValue:f.status,"onUpdate:modelValue":e[7]||(e[7]=a=>f.status=a),placeholder:"选择状态",clearable:"",style:{width:"200px"},"popper-append-to-body":!1},{default:l(()=>[t(u,{label:"待审核",value:"1"}),t(u,{label:"已通过",value:"2"}),t(u,{label:"已拒绝",value:"3"})]),_:1},8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(d,{type:"primary",onClick:w},{default:l(()=>[...e[27]||(e[27]=[r("搜索",-1)])]),_:1}),t(d,{onClick:_e},{default:l(()=>[...e[28]||(e[28]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",pt,[t(d,{type:"primary",onClick:e[8]||(e[8]=a=>C.value=!0)},{default:l(()=>[t(i,null,{default:l(()=>[t(I(He))]),_:1}),e[29]||(e[29]=r(" 申请请假 ",-1))]),_:1})]),s("div",ct,[s("div",_t,[s("div",mt,p(U.value.total),1),e[30]||(e[30]=s("div",{class:"leave-stat-label"},"总申请数",-1))]),s("div",vt,[s("div",ft,p(U.value.pending),1),e[31]||(e[31]=s("div",{class:"leave-stat-label"},"待审核",-1))]),s("div",gt,[s("div",yt,p(U.value.approved),1),e[32]||(e[32]=s("div",{class:"leave-stat-label"},"已通过",-1))]),s("div",bt,[s("div",kt,p(U.value.rejected),1),e[33]||(e[33]=s("div",{class:"leave-stat-label"},"已拒绝",-1))])]),s("div",Vt,[Z((T(),M(W,{data:x.value,stripe:"",border:"","table-layout":"fixed"},{default:l(()=>[t(n,{prop:"user_name",label:"员工姓名"}),t(n,{prop:"position_name",label:"岗位"}),t(n,{prop:"type",label:"请假类型"},{default:l(({row:a})=>[r(p(de(a.type)),1)]),_:1}),t(n,{prop:"start_date",label:"开始日期"}),t(n,{prop:"end_date",label:"结束日期"}),t(n,{label:"请假天数"},{default:l(({row:a})=>[s("span",ht,p(ue(a.start_date,a.end_date))+"天",1)]),_:1}),t(n,{prop:"reason",label:"请假原因"},{default:l(({row:a})=>[s("span",{class:"leave-reason",title:a.reason},p(a.reason),9,wt)]),_:1}),t(n,{prop:"status",label:"状态"},{default:l(({row:a})=>[t(ke,{type:re(a.status)},{default:l(()=>[r(p(ie(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(n,{prop:"created_at",label:"申请时间"}),t(n,{label:"操作",width:"250","show-overflow-tooltip":""},{default:l(({row:a})=>[s("div",xt,[t(d,{size:"small",onClick:X=>ye(a)},{default:l(()=>[...e[34]||(e[34]=[r("查看详情",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"success",onClick:X=>K(a,2)},{default:l(()=>[...e[35]||(e[35]=[r("通过",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",onClick:X=>K(a,3)},{default:l(()=>[...e[36]||(e[36]=[r("拒绝",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Q,B.value]])]),s("div",Ct,[t(G,{"current-page":k.page,"onUpdate:currentPage":e[9]||(e[9]=a=>k.page=a),"page-size":k.limit,"onUpdate:pageSize":e[10]||(e[10]=a=>k.limit=a),total:k.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1},8,["modelValue"]),t(he,{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=a=>C.value=a),title:"申请请假",width:"600px"},{footer:l(()=>[t(d,{onClick:e[17]||(e[17]=a=>C.value=!1)},{default:l(()=>[...e[37]||(e[37]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:fe},{default:l(()=>[...e[38]||(e[38]=[r("提交申请",-1)])]),_:1})]),default:l(()=>[t(P,{model:c,rules:oe,ref_key:"leaveFormRef",ref:$,"label-width":"100px"},{default:l(()=>[t(_,{label:"请假类型",prop:"type"},{default:l(()=>[t(S,{modelValue:c.type,"onUpdate:modelValue":e[12]||(e[12]=a=>c.type=a),placeholder:"选择请假类型",style:{width:"100%"}},{default:l(()=>[t(u,{label:"年假",value:"annual"}),t(u,{label:"病假",value:"sick"}),t(u,{label:"事假",value:"personal"}),t(u,{label:"调休",value:"compensatory"}),t(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"开始日期",prop:"start_date"},{default:l(()=>[t(z,{modelValue:c.start_date,"onUpdate:modelValue":e[13]||(e[13]=a=>c.start_date=a),type:"date",placeholder:"选择开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(_,{label:"结束日期",prop:"end_date"},{default:l(()=>[t(z,{modelValue:c.end_date,"onUpdate:modelValue":e[14]||(e[14]=a=>c.end_date=a),type:"date",placeholder:"选择结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(_,{label:"请假原因",prop:"reason"},{default:l(()=>[t(F,{modelValue:c.reason,"onUpdate:modelValue":e[15]||(e[15]=a=>c.reason=a),type:"textarea",rows:4,placeholder:"请输入请假原因"},null,8,["modelValue"])]),_:1}),t(_,{label:"紧急联系人"},{default:l(()=>[t(F,{modelValue:c.emergency_contact,"onUpdate:modelValue":e[16]||(e[16]=a=>c.emergency_contact=a),placeholder:"请输入紧急联系人及电话"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},$t=we(Lt,[["__scopeId","data-v-a1be5114"]]);export{$t as default};
