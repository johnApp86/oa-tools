import{_ as H}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                     *//* empty css                *//* empty css                       */import{G as m,K as T,c as Q,H as W,r as X,o as x,a as Y,b as g,d as t,w as a,L as Z,M as ee,J as te,N as le,O as oe,P as ae,Q as ne,R as re,f as r,I as se,S as de,T as c,U as ie,V as ue,h as pe,W as me,X as ce,Y as _e,Z as fe,_ as ve,$ as ge}from"./index-4e5dc47e.js";import{g as z}from"./organization-22ca4e80.js";import"./request-3883ec4c.js";const be={class:"organization-management"},ye={class:"search-form"},Ve={class:"button-group"},ke={class:"table-container"},we={class:"operation-buttons"},Ce={__name:"Organization",setup(Ee){const b=m(!1),V=m([]),k=m([]),i=m(!1),y=m(!1),v=m(),_=T({keyword:""}),l=T({id:null,name:"",code:"",parentId:0,level:1,sortOrder:0,status:1}),U={name:[{required:!0,message:"请输入组织名称",trigger:"blur"}],code:[{required:!0,message:"请输入组织代码",trigger:"blur"}]},D=Q(()=>l.id?"编辑组织":l.parentId&&l.parentId!==0?"添加子组织":"新增组织"),f=async()=>{b.value=!0;try{const o={keyword:_.keyword},e=await z();V.value=e}catch(o){console.error("加载数据失败:",o)}finally{b.value=!1}},w=async()=>{try{const o=await z();k.value=o}catch(o){console.error("加载组织树失败:",o)}},C=()=>{f()},B=()=>{_.keyword="",f()},S=()=>{Object.assign(l,{id:null,name:"",code:"",parentId:0,level:1,sortOrder:0,status:1}),i.value=!0},j=o=>{Object.assign(l,{id:null,name:"",code:"",parentId:o.id,level:o.level+1,sortOrder:0,status:1}),i.value=!0},N=o=>{Object.assign(l,{id:o.id,name:o.name,code:o.code,parentId:o.parent_id,level:o.level,sortOrder:o.sort_order,status:o.status}),i.value=!0},R=async o=>{try{await de.confirm("确定要删除该组织吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await fetch(`/api/organizations/${o.id}`,{method:"DELETE"});if(e.ok)c.success("删除成功"),f();else{const u=await e.json();c.error(u.message||"删除失败")}}catch(e){e!=="cancel"&&(console.error("删除失败:",e),c.error("删除失败"))}},$=async()=>{if(v.value)try{await v.value.validate(),y.value=!0;const o={name:l.name,code:l.code,parentId:l.parentId,level:l.level,sortOrder:l.sortOrder,status:l.status};let e;if(l.id?e=await fetch(`/api/organizations/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}):e=await fetch("/api/organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),e.ok)c.success(l.id?"更新成功":"创建成功"),i.value=!1,f(),w();else{const u=await e.json();c.error(u.message||"操作失败")}}catch(o){console.error("提交失败:",o),c.error("操作失败")}finally{y.value=!1}},P=()=>{var o;(o=v.value)==null||o.resetFields()};return W(()=>{f(),w()}),(o,e)=>{const u=ie,s=ue,d=te,E=le,F=X("Plus"),L=pe,p=me,M=ce,J=oe,K=_e,O=fe,h=ve,q=ge,A=ae,G=ne;return x(),Y("div",be,[g("div",ye,[t(E,{model:_,inline:""},{default:a(()=>[t(s,{label:"关键词"},{default:a(()=>[t(u,{modelValue:_.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>_.keyword=n),placeholder:"请输入组织名称或代码",clearable:"",onKeyup:re(C,["enter"])},null,8,["modelValue"])]),_:1}),t(s,null,{default:a(()=>[t(d,{type:"primary",onClick:C},{default:a(()=>[...e[9]||(e[9]=[r("搜索",-1)])]),_:1}),t(d,{onClick:B},{default:a(()=>[...e[10]||(e[10]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),g("div",Ve,[t(d,{type:"primary",onClick:S},{default:a(()=>[t(L,null,{default:a(()=>[t(F)]),_:1}),e[11]||(e[11]=r(" 新增组织 ",-1))]),_:1})]),g("div",ke,[Z((x(),ee(J,{data:V.value,stripe:"",border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"}},{default:a(()=>[t(p,{prop:"name",label:"组织名称",width:"200"}),t(p,{prop:"code",label:"组织代码",width:"150"}),t(p,{prop:"level",label:"层级",width:"80"}),t(p,{prop:"sort_order",label:"排序",width:"80"}),t(p,{prop:"status",label:"状态",width:"100"},{default:a(({row:n})=>[t(M,{type:n.status===1?"success":"danger"},{default:a(()=>[r(se(n.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"created_at",label:"创建时间",width:"180"}),t(p,{label:"操作",width:"280",fixed:"right"},{default:a(({row:n})=>[g("div",we,[t(d,{size:"small",onClick:I=>N(n)},{default:a(()=>[...e[12]||(e[12]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"primary",onClick:I=>j(n)},{default:a(()=>[...e[13]||(e[13]=[r(" 添加子组织 ",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",onClick:I=>R(n)},{default:a(()=>[...e[14]||(e[14]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[G,b.value]])]),t(A,{modelValue:i.value,"onUpdate:modelValue":e[8]||(e[8]=n=>i.value=n),title:D.value,width:"600px",onClose:P},{footer:a(()=>[t(d,{onClick:e[7]||(e[7]=n=>i.value=!1)},{default:a(()=>[...e[17]||(e[17]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:$,loading:y.value},{default:a(()=>[...e[18]||(e[18]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(E,{ref_key:"formRef",ref:v,model:l,rules:U,"label-width":"100px"},{default:a(()=>[t(s,{label:"组织名称",prop:"name"},{default:a(()=>[t(u,{modelValue:l.name,"onUpdate:modelValue":e[1]||(e[1]=n=>l.name=n),placeholder:"请输入组织名称"},null,8,["modelValue"])]),_:1}),t(s,{label:"组织代码",prop:"code"},{default:a(()=>[t(u,{modelValue:l.code,"onUpdate:modelValue":e[2]||(e[2]=n=>l.code=n),placeholder:"请输入组织代码"},null,8,["modelValue"])]),_:1}),t(s,{label:"父级组织",prop:"parentId"},{default:a(()=>[t(K,{modelValue:l.parentId,"onUpdate:modelValue":e[3]||(e[3]=n=>l.parentId=n),data:k.value,props:{label:"name",value:"id"},placeholder:"请选择父级组织",style:{width:"100%"},clearable:""},null,8,["modelValue","data"])]),_:1}),t(s,{label:"层级",prop:"level"},{default:a(()=>[t(O,{modelValue:l.level,"onUpdate:modelValue":e[4]||(e[4]=n=>l.level=n),min:1,max:10},null,8,["modelValue"])]),_:1}),t(s,{label:"排序",prop:"sortOrder"},{default:a(()=>[t(O,{modelValue:l.sortOrder,"onUpdate:modelValue":e[5]||(e[5]=n=>l.sortOrder=n),min:0},null,8,["modelValue"])]),_:1}),t(s,{label:"状态",prop:"status"},{default:a(()=>[t(q,{modelValue:l.status,"onUpdate:modelValue":e[6]||(e[6]=n=>l.status=n)},{default:a(()=>[t(h,{label:1},{default:a(()=>[...e[15]||(e[15]=[r("启用",-1)])]),_:1}),t(h,{label:0},{default:a(()=>[...e[16]||(e[16]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},$e=H(Ce,[["__scopeId","data-v-6b57dbe4"]]);export{$e as default};
