import{_ as H}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                     *//* empty css                *//* empty css                       */import{G as m,K as T,c as Q,H as W,r as X,o as x,a as Y,b as g,d as o,w as a,L as Z,M as ee,J as oe,N as te,O as le,P as ae,Q as ne,R as re,f as r,I as se,S as de,T as c,U as ie,V as ue,h as pe,W as me,X as ce,Y as fe,Z as _e,_ as ve,$ as ge}from"./index-25be2468.js";import{g as z}from"./organization-0a1f3a19.js";import"./request-b9763afa.js";const be={class:"organization-management"},ye={class:"search-form"},we={class:"button-group"},Ve={class:"table-container"},he={class:"operation-buttons"},ke={__name:"Organization",setup(Ce){const b=m(!1),w=m([]),V=m([]),i=m(!1),y=m(!1),v=m(),f=T({keyword:""}),t=T({id:null,name:"",code:"",parentId:0,level:1,sortOrder:0,status:1}),U={name:[{required:!0,message:"请输入组织名称",trigger:"blur"}],code:[{required:!0,message:"请输入组织代码",trigger:"blur"}]},D=Q(()=>t.id?"编辑组织":t.parentId&&t.parentId!==0?"添加子组织":"新增组织"),_=async()=>{b.value=!0;try{const l={keyword:f.keyword},e=await z();w.value=e}catch(l){console.error("加载数据失败:",l)}finally{b.value=!1}},h=async()=>{try{const l=await z();V.value=l}catch(l){console.error("加载组织树失败:",l)}},k=()=>{_()},B=()=>{f.keyword="",_()},S=()=>{Object.assign(t,{id:null,name:"",code:"",parentId:0,level:1,sortOrder:0,status:1}),i.value=!0},j=l=>{Object.assign(t,{id:null,name:"",code:"",parentId:l.id,level:l.level+1,sortOrder:0,status:1}),i.value=!0},N=l=>{Object.assign(t,{id:l.id,name:l.name,code:l.code,parentId:l.parent_id,level:l.level,sortOrder:l.sort_order,status:l.status}),i.value=!0},R=async l=>{try{await de.confirm("确定要删除该组织吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await fetch(`/api/organizations/${l.id}`,{method:"DELETE"});if(e.ok)c.success("删除成功"),_();else{const u=await e.json();c.error(u.message||"删除失败")}}catch(e){e!=="cancel"&&(console.error("删除失败:",e),c.error("删除失败"))}},$=async()=>{if(v.value)try{await v.value.validate(),y.value=!0;const l={name:t.name,code:t.code,parentId:t.parentId,level:t.level,sortOrder:t.sortOrder,status:t.status};let e;if(t.id?e=await fetch(`/api/organizations/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}):e=await fetch("/api/organizations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),e.ok)c.success(t.id?"更新成功":"创建成功"),i.value=!1,_(),h();else{const u=await e.json();c.error(u.message||"操作失败")}}catch(l){console.error("提交失败:",l),c.error("操作失败")}finally{y.value=!1}},P=()=>{var l;(l=v.value)==null||l.resetFields()};return W(()=>{_(),h()}),(l,e)=>{const u=ie,s=ue,d=oe,C=te,F=X("Plus"),L=pe,p=me,M=ce,J=le,K=fe,E=_e,O=ve,q=ge,A=ae,G=ne;return x(),Y("div",be,[g("div",ye,[o(C,{model:f,inline:""},{default:a(()=>[o(s,{label:"关键词"},{default:a(()=>[o(u,{modelValue:f.keyword,"onUpdate:modelValue":e[0]||(e[0]=n=>f.keyword=n),placeholder:"请输入组织名称或代码",clearable:"",onKeyup:re(k,["enter"])},null,8,["modelValue"])]),_:1}),o(s,null,{default:a(()=>[o(d,{type:"primary",onClick:k},{default:a(()=>[...e[9]||(e[9]=[r("搜索",-1)])]),_:1}),o(d,{onClick:B},{default:a(()=>[...e[10]||(e[10]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),g("div",we,[o(d,{type:"primary",onClick:S},{default:a(()=>[o(L,null,{default:a(()=>[o(F)]),_:1}),e[11]||(e[11]=r(" 新增组织 ",-1))]),_:1})]),g("div",Ve,[Z((x(),ee(J,{data:w.value,stripe:"",border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"table-layout":"fixed"},{default:a(()=>[o(p,{prop:"name",label:"组织名称",width:"200","show-overflow-tooltip":""}),o(p,{prop:"code",label:"组织代码",width:"150","show-overflow-tooltip":""}),o(p,{prop:"level",label:"层级",width:"80","show-overflow-tooltip":""}),o(p,{prop:"sort_order",label:"排序",width:"80","show-overflow-tooltip":""}),o(p,{prop:"status",label:"状态",width:"100","show-overflow-tooltip":""},{default:a(({row:n})=>[o(M,{type:n.status===1?"success":"danger"},{default:a(()=>[r(se(n.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),o(p,{prop:"created_at",label:"创建时间",width:"180","show-overflow-tooltip":""}),o(p,{label:"操作",width:"280","show-overflow-tooltipfixed":"right"},{default:a(({row:n})=>[g("div",he,[o(d,{size:"small",onClick:I=>N(n)},{default:a(()=>[...e[12]||(e[12]=[r("编辑",-1)])]),_:1},8,["onClick"]),o(d,{size:"small",type:"primary",onClick:I=>j(n)},{default:a(()=>[...e[13]||(e[13]=[r(" 添加子组织 ",-1)])]),_:1},8,["onClick"]),o(d,{size:"small",type:"danger",onClick:I=>R(n)},{default:a(()=>[...e[14]||(e[14]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[G,b.value]])]),o(A,{modelValue:i.value,"onUpdate:modelValue":e[8]||(e[8]=n=>i.value=n),title:D.value,width:"600px",onClose:P},{footer:a(()=>[o(d,{onClick:e[7]||(e[7]=n=>i.value=!1)},{default:a(()=>[...e[17]||(e[17]=[r("取消",-1)])]),_:1}),o(d,{type:"primary",onClick:$,loading:y.value},{default:a(()=>[...e[18]||(e[18]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[o(C,{ref_key:"formRef",ref:v,model:t,rules:U,"label-width":"100px"},{default:a(()=>[o(s,{label:"组织名称",prop:"name"},{default:a(()=>[o(u,{modelValue:t.name,"onUpdate:modelValue":e[1]||(e[1]=n=>t.name=n),placeholder:"请输入组织名称"},null,8,["modelValue"])]),_:1}),o(s,{label:"组织代码",prop:"code"},{default:a(()=>[o(u,{modelValue:t.code,"onUpdate:modelValue":e[2]||(e[2]=n=>t.code=n),placeholder:"请输入组织代码"},null,8,["modelValue"])]),_:1}),o(s,{label:"父级组织",prop:"parentId"},{default:a(()=>[o(K,{modelValue:t.parentId,"onUpdate:modelValue":e[3]||(e[3]=n=>t.parentId=n),data:V.value,props:{label:"name",value:"id"},placeholder:"请选择父级组织",style:{width:"100%"},clearable:""},null,8,["modelValue","data"])]),_:1}),o(s,{label:"层级",prop:"level"},{default:a(()=>[o(E,{modelValue:t.level,"onUpdate:modelValue":e[4]||(e[4]=n=>t.level=n),min:1,max:10},null,8,["modelValue"])]),_:1}),o(s,{label:"排序",prop:"sortOrder"},{default:a(()=>[o(E,{modelValue:t.sortOrder,"onUpdate:modelValue":e[5]||(e[5]=n=>t.sortOrder=n),min:0},null,8,["modelValue"])]),_:1}),o(s,{label:"状态",prop:"status"},{default:a(()=>[o(q,{modelValue:t.status,"onUpdate:modelValue":e[6]||(e[6]=n=>t.status=n)},{default:a(()=>[o(O,{label:1},{default:a(()=>[...e[15]||(e[15]=[r("启用",-1)])]),_:1}),o(O,{label:0},{default:a(()=>[...e[16]||(e[16]=[r("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},$e=H(ke,[["__scopeId","data-v-e92d1b84"]]);export{$e as default};
