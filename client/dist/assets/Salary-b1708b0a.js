import{_ as se}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css               *//* empty css                *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                      *//* empty css                  *//* empty css                     */import{G as k,K as N,c as C,H as ne,o as r,a as y,b as n,d as a,w as t,L as re,M as g,T as E,J as de,N as ue,O as ie,a0 as pe,P as me,aa as ce,Q as _e,a1 as x,a2 as U,f as p,g as fe,I as f,S as ve,a3 as be,V as ye,h as ge,W as we,Z as he,U as Ve,a9 as ke,ab as Ce,x as Ee,a4 as xe}from"./index-25be2468.js";import{m as Ue,n as Se,o as Re}from"./hr-d3c416c7.js";import{g as Fe}from"./user-61247764.js";import"./request-b9763afa.js";const ze={class:"salary-management"},Be={class:"search-form"},De={class:"button-group"},Ne={class:"table-container"},Ie={class:"total-salary"},Oe={class:"operation-buttons"},Le={class:"pagination"},Me={class:"statistics-cards"},Te={class:"stat-content"},qe={class:"stat-value"},$e={class:"stat-content"},je={class:"stat-value"},Pe={class:"stat-content"},Ae={class:"stat-value"},Ye={class:"stat-content"},Ge={class:"stat-value"},He={__name:"Salary",setup(Je){const z=k(!1),w=k([]),h=k(!1),B=k(null),D=k([]),i=N({user_id:"",year:"",month:""}),c=N({page:1,limit:10,total:0}),s=N({user_id:"",year:"",month:"",base_salary:0,bonus:0,allowance:0,deduction:0,notes:""}),q={user_id:[{required:!0,message:"请选择员工",trigger:"change"}],year:[{required:!0,message:"请选择年份",trigger:"change"}],month:[{required:!0,message:"请选择月份",trigger:"change"}],base_salary:[{required:!0,message:"请输入基本工资",trigger:"blur"}]},I=k(),O=C(()=>{const o=new Date().getFullYear(),e=[];for(let m=o-5;m<=o+1;m++)e.push(m);return e}),L=C(()=>Array.from({length:12},(o,e)=>e+1)),M=o=>(o.base_salary||0)+(o.bonus||0)+(o.allowance||0)-(o.deduction||0),_=o=>o?Number(o).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",$=C(()=>w.value.reduce((o,e)=>o+(e.base_salary||0),0)),j=C(()=>w.value.reduce((o,e)=>o+(e.bonus||0),0)),P=C(()=>w.value.reduce((o,e)=>o+(e.allowance||0),0)),A=C(()=>w.value.reduce((o,e)=>o+M(e),0)),v=async()=>{z.value=!0;try{const o={page:c.page,limit:c.limit,...i},e=await Ue(o);w.value=e.data,c.total=e.total}catch{E.error("加载数据失败")}finally{z.value=!1}},Y=()=>{i.user_id="",i.year="",i.month="",c.page=1,v()},G=async()=>{try{await I.value.validate(),await Se(s),E.success("保存成功"),h.value=!1,H(),v()}catch{E.error("保存失败")}},H=()=>{Object.assign(s,{user_id:"",year:"",month:"",base_salary:0,bonus:0,allowance:0,deduction:0,notes:""}),B.value=null},J=o=>{B.value=o,Object.assign(s,o),h.value=!0},K=async o=>{try{await ve.confirm("确定要删除这条薪酬记录吗？","提示",{type:"warning"}),await Re(o.id),E.success("删除成功"),v()}catch(e){e!=="cancel"&&E.error(e.message||"删除失败")}},Q=async()=>{try{const o=await Fe();D.value=o.data||o}catch{E.error("加载基础数据失败")}};return ne(()=>{v(),Q()}),(o,e)=>{const m=xe,V=be,d=ye,b=de,T=ue,W=ge,u=we,Z=ie,X=pe,S=he,ee=Ve,le=me,R=ke,F=Ce,ae=ce,te=_e;return r(),y("div",ze,[n("div",Be,[a(T,{model:i,inline:""},{default:t(()=>[a(d,{label:"员工"},{default:t(()=>[a(V,{modelValue:i.user_id,"onUpdate:modelValue":e[0]||(e[0]=l=>i.user_id=l),placeholder:"选择员工",clearable:"",style:{width:"200px"},"popper-append-to-body":!1},{default:t(()=>[(r(!0),y(x,null,U(D.value,l=>(r(),g(m,{key:l.id,label:l.real_name||l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"年份"},{default:t(()=>[a(V,{modelValue:i.year,"onUpdate:modelValue":e[1]||(e[1]=l=>i.year=l),placeholder:"选择年份",clearable:"",style:{width:"200px"},"popper-append-to-body":!1},{default:t(()=>[(r(!0),y(x,null,U(O.value,l=>(r(),g(m,{key:l,label:l+"年",value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"月份"},{default:t(()=>[a(V,{modelValue:i.month,"onUpdate:modelValue":e[2]||(e[2]=l=>i.month=l),placeholder:"选择月份",clearable:"",style:{width:"200px"},"popper-append-to-body":!1},{default:t(()=>[(r(!0),y(x,null,U(L.value,l=>(r(),g(m,{key:l,label:l+"月",value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,null,{default:t(()=>[a(b,{type:"primary",onClick:v},{default:t(()=>[...e[16]||(e[16]=[p("搜索",-1)])]),_:1}),a(b,{onClick:Y},{default:t(()=>[...e[17]||(e[17]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",De,[a(b,{type:"primary",onClick:e[3]||(e[3]=l=>h.value=!0)},{default:t(()=>[a(W,null,{default:t(()=>[a(fe(Ee))]),_:1}),e[18]||(e[18]=p(" 新增薪酬记录 ",-1))]),_:1})]),n("div",Ne,[re((r(),g(Z,{data:w.value,stripe:"",border:"",style:{width:"100%"},"table-layout":"fixed"},{default:t(()=>[a(u,{prop:"user_name",label:"员工姓名",width:"120","show-overflow-tooltip":""}),a(u,{prop:"position_name",label:"岗位",width:"120","show-overflow-tooltip":""}),a(u,{prop:"year",label:"年份",width:"80","show-overflow-tooltip":""}),a(u,{prop:"month",label:"月份",width:"80","show-overflow-tooltip":""}),a(u,{prop:"base_salary",label:"基本工资",width:"120",align:"right","show-overflow-tooltip":""},{default:t(({row:l})=>[p(" ¥"+f(_(l.base_salary)),1)]),_:1}),a(u,{prop:"bonus",label:"奖金",width:"120",align:"right","show-overflow-tooltip":""},{default:t(({row:l})=>[p(" ¥"+f(_(l.bonus)),1)]),_:1}),a(u,{prop:"allowance",label:"津贴",width:"120",align:"right","show-overflow-tooltip":""},{default:t(({row:l})=>[p(" ¥"+f(_(l.allowance)),1)]),_:1}),a(u,{prop:"deduction",label:"扣除",width:"120",align:"right","show-overflow-tooltip":""},{default:t(({row:l})=>[p(" ¥"+f(_(l.deduction)),1)]),_:1}),a(u,{label:"实发工资",width:"140",align:"right","show-overflow-tooltip":""},{default:t(({row:l})=>[n("span",Ie," ¥"+f(_(M(l))),1)]),_:1}),a(u,{prop:"notes",label:"备注","min-width":"150","show-overflow-tooltip":""}),a(u,{prop:"created_at",label:"创建时间",width:"180","show-overflow-tooltip":""}),a(u,{label:"操作",width:"280","show-overflow-tooltip":""},{default:t(({row:l})=>[n("div",Oe,[a(b,{size:"small",onClick:oe=>J(l)},{default:t(()=>[...e[19]||(e[19]=[p("编辑",-1)])]),_:1},8,["onClick"]),a(b,{size:"small",type:"danger",onClick:oe=>K(l)},{default:t(()=>[...e[20]||(e[20]=[p("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[te,z.value]])]),n("div",Le,[a(X,{"current-page":c.page,"onUpdate:currentPage":e[4]||(e[4]=l=>c.page=l),"page-size":c.limit,"onUpdate:pageSize":e[5]||(e[5]=l=>c.limit=l),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),a(le,{modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=l=>h.value=l),title:B.value?"编辑薪酬记录":"新增薪酬记录",width:"600px"},{footer:t(()=>[a(b,{onClick:e[14]||(e[14]=l=>h.value=!1)},{default:t(()=>[...e[21]||(e[21]=[p("取消",-1)])]),_:1}),a(b,{type:"primary",onClick:G},{default:t(()=>[...e[22]||(e[22]=[p("保存",-1)])]),_:1})]),default:t(()=>[a(T,{model:s,rules:q,ref_key:"salaryFormRef",ref:I,"label-width":"100px"},{default:t(()=>[a(d,{label:"员工",prop:"user_id"},{default:t(()=>[a(V,{modelValue:s.user_id,"onUpdate:modelValue":e[6]||(e[6]=l=>s.user_id=l),placeholder:"选择员工",style:{width:"100%"}},{default:t(()=>[(r(!0),y(x,null,U(D.value,l=>(r(),g(m,{key:l.id,label:l.real_name||l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"年份",prop:"year"},{default:t(()=>[a(V,{modelValue:s.year,"onUpdate:modelValue":e[7]||(e[7]=l=>s.year=l),placeholder:"选择年份",style:{width:"100%"}},{default:t(()=>[(r(!0),y(x,null,U(O.value,l=>(r(),g(m,{key:l,label:l+"年",value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"月份",prop:"month"},{default:t(()=>[a(V,{modelValue:s.month,"onUpdate:modelValue":e[8]||(e[8]=l=>s.month=l),placeholder:"选择月份",style:{width:"100%"}},{default:t(()=>[(r(!0),y(x,null,U(L.value,l=>(r(),g(m,{key:l,label:l+"月",value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"基本工资",prop:"base_salary"},{default:t(()=>[a(S,{modelValue:s.base_salary,"onUpdate:modelValue":e[9]||(e[9]=l=>s.base_salary=l),min:0,precision:2,placeholder:"请输入基本工资",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{label:"奖金"},{default:t(()=>[a(S,{modelValue:s.bonus,"onUpdate:modelValue":e[10]||(e[10]=l=>s.bonus=l),min:0,precision:2,placeholder:"请输入奖金",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{label:"津贴"},{default:t(()=>[a(S,{modelValue:s.allowance,"onUpdate:modelValue":e[11]||(e[11]=l=>s.allowance=l),min:0,precision:2,placeholder:"请输入津贴",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{label:"扣除"},{default:t(()=>[a(S,{modelValue:s.deduction,"onUpdate:modelValue":e[12]||(e[12]=l=>s.deduction=l),min:0,precision:2,placeholder:"请输入扣除金额",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{label:"备注"},{default:t(()=>[a(ee,{modelValue:s.notes,"onUpdate:modelValue":e[13]||(e[13]=l=>s.notes=l),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),n("div",Me,[a(ae,{gutter:20},{default:t(()=>[a(F,{span:6},{default:t(()=>[a(R,{class:"stat-card"},{default:t(()=>[n("div",Te,[n("div",qe,"¥"+f(_($.value)),1),e[23]||(e[23]=n("div",{class:"stat-label"},"基本工资总额",-1))])]),_:1})]),_:1}),a(F,{span:6},{default:t(()=>[a(R,{class:"stat-card"},{default:t(()=>[n("div",$e,[n("div",je,"¥"+f(_(j.value)),1),e[24]||(e[24]=n("div",{class:"stat-label"},"奖金总额",-1))])]),_:1})]),_:1}),a(F,{span:6},{default:t(()=>[a(R,{class:"stat-card"},{default:t(()=>[n("div",Pe,[n("div",Ae,"¥"+f(_(P.value)),1),e[25]||(e[25]=n("div",{class:"stat-label"},"津贴总额",-1))])]),_:1})]),_:1}),a(F,{span:6},{default:t(()=>[a(R,{class:"stat-card"},{default:t(()=>[n("div",Ye,[n("div",Ge,"¥"+f(_(A.value)),1),e[26]||(e[26]=n("div",{class:"stat-label"},"实发工资总额",-1))])]),_:1})]),_:1})]),_:1})])])}}},ul=se(He,[["__scopeId","data-v-33866acf"]]);export{ul as default};
