import{_ as ne}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                *//* empty css                   *//* empty css                       *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                 */import{G as i,K as x,c as se,H as re,r as ie,o as P,a as de,b as k,d as t,w as o,L as ue,M as pe,J as me,N as ce,O as fe,a0 as ge,P as _e,Q as ve,R as ye,f as s,I as be,S as ke,T as S,U as Ce,V as Ve,h as he,W as we,X as Re,_ as Ee,$ as xe,a5 as Te}from"./index-4e5dc47e.js";import{r as _}from"./request-3883ec4c.js";const De=d=>_({url:"/roles",method:"get",params:d}),ze=d=>_({url:`/roles/${d}`,method:"get"}),Ue=d=>_({url:"/roles",method:"post",data:d}),$e=(d,v)=>_({url:`/roles/${d}`,method:"put",data:v}),Be=d=>_({url:`/roles/${d}`,method:"delete"}),Ke=()=>_({url:"/menus/tree",method:"get"});const Pe={class:"role-management"},Se={class:"search-form"},Ie={class:"button-group"},Me={class:"table-container"},Le={class:"operation-buttons"},Fe={class:"pagination"},Ne={__name:"Role",setup(d){const v=i(!1),T=i([]),D=i([]),c=i(!1),y=i(!1),V=i(!1),h=i(!1),C=i(),w=i(),b=x({keyword:""}),r=x({page:1,limit:10,total:0}),n=x({id:null,name:"",code:"",description:"",status:1}),z=i(null),R=i([]),I={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色代码",trigger:"blur"}]},M=se(()=>n.id?"编辑角色":"新增角色"),f=async()=>{v.value=!0;try{const l={page:r.page,limit:r.limit,keyword:b.keyword},e=await De(l);T.value=e.data,r.total=e.total}catch(l){console.error("加载数据失败:",l)}finally{v.value=!1}},L=async()=>{try{const l=await Ke();D.value=l}catch(l){console.error("加载菜单树失败:",l)}},E=()=>{r.page=1,f()},F=()=>{b.keyword="",E()},N=()=>{Object.assign(n,{id:null,name:"",code:"",description:"",status:1}),c.value=!0},j=l=>{Object.assign(n,{id:l.id,name:l.name,code:l.code,description:l.description,status:l.status}),c.value=!0},q=async l=>{try{await ke.confirm("确定要删除该角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Be(l.id),S.success("删除成功"),f()}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},O=async l=>{z.value=l.id;try{const e=await ze(l.id);R.value=e.permissions?e.permissions.map(p=>p.menu_id):[],y.value=!0}catch(e){console.error("获取角色权限失败:",e)}},G=async()=>{if(C.value)try{await C.value.validate(),V.value=!0,n.id?await $e(n.id,n):await Ue(n),c.value=!1,f()}catch(l){console.error("提交失败:",l)}finally{V.value=!1}},H=async()=>{try{h.value=!0;const l=w.value.getCheckedKeys(),e=w.value.getHalfCheckedKeys(),p=[...l,...e];S.success("权限设置成功"),y.value=!1}catch(l){console.error("设置权限失败:",l)}finally{h.value=!1}},A=()=>{var l;(l=C.value)==null||l.resetFields()},J=()=>{z.value=null,R.value=[]},Q=l=>{r.limit=l,f()},W=l=>{r.page=l,f()};return re(()=>{f(),L()}),(l,e)=>{const p=Ce,g=Ve,u=me,U=ce,X=ie("Plus"),Y=he,m=we,Z=Re,ee=fe,te=ge,$=Ee,le=xe,B=_e,oe=Te,ae=ve;return P(),de("div",Pe,[k("div",Se,[t(U,{model:b,inline:""},{default:o(()=>[t(g,{label:"关键词"},{default:o(()=>[t(p,{modelValue:b.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>b.keyword=a),placeholder:"请输入角色名称或代码",clearable:"",onKeyup:ye(E,["enter"])},null,8,["modelValue"])]),_:1}),t(g,null,{default:o(()=>[t(u,{type:"primary",onClick:E},{default:o(()=>[...e[11]||(e[11]=[s("搜索",-1)])]),_:1}),t(u,{onClick:F},{default:o(()=>[...e[12]||(e[12]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),k("div",Ie,[t(u,{type:"primary",onClick:N},{default:o(()=>[t(Y,null,{default:o(()=>[t(X)]),_:1}),e[13]||(e[13]=s(" 新增角色 ",-1))]),_:1})]),k("div",Me,[ue((P(),pe(ee,{data:T.value,stripe:"",border:""},{default:o(()=>[t(m,{prop:"id",label:"ID",width:"80"}),t(m,{prop:"name",label:"角色名称",width:"150"}),t(m,{prop:"code",label:"角色代码",width:"120"}),t(m,{prop:"description",label:"描述","min-width":"200"}),t(m,{prop:"status",label:"状态",width:"100"},{default:o(({row:a})=>[t(Z,{type:a.status===1?"success":"danger"},{default:o(()=>[s(be(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"created_at",label:"创建时间",width:"180"}),t(m,{label:"操作",width:"280",fixed:"right"},{default:o(({row:a})=>[k("div",Le,[t(u,{size:"small",onClick:K=>j(a)},{default:o(()=>[...e[14]||(e[14]=[s("编辑",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"primary",onClick:K=>O(a)},{default:o(()=>[...e[15]||(e[15]=[s(" 权限设置 ",-1)])]),_:1},8,["onClick"]),t(u,{size:"small",type:"danger",onClick:K=>q(a)},{default:o(()=>[...e[16]||(e[16]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[ae,v.value]]),k("div",Fe,[t(te,{"current-page":r.page,"onUpdate:currentPage":e[1]||(e[1]=a=>r.page=a),"page-size":r.limit,"onUpdate:pageSize":e[2]||(e[2]=a=>r.limit=a),total:r.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),t(B,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a),title:M.value,width:"600px",onClose:A},{footer:o(()=>[t(u,{onClick:e[7]||(e[7]=a=>c.value=!1)},{default:o(()=>[...e[19]||(e[19]=[s("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:G,loading:V.value},{default:o(()=>[...e[20]||(e[20]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(U,{ref_key:"formRef",ref:C,model:n,rules:I,"label-width":"100px"},{default:o(()=>[t(g,{label:"角色名称",prop:"name"},{default:o(()=>[t(p,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.name=a),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"角色代码",prop:"code"},{default:o(()=>[t(p,{modelValue:n.code,"onUpdate:modelValue":e[4]||(e[4]=a=>n.code=a),placeholder:"请输入角色代码"},null,8,["modelValue"])]),_:1}),t(g,{label:"描述",prop:"description"},{default:o(()=>[t(p,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入角色描述"},null,8,["modelValue"])]),_:1}),t(g,{label:"状态",prop:"status"},{default:o(()=>[t(le,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=a=>n.status=a)},{default:o(()=>[t($,{label:1},{default:o(()=>[...e[17]||(e[17]=[s("启用",-1)])]),_:1}),t($,{label:0},{default:o(()=>[...e[18]||(e[18]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(B,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=a=>y.value=a),title:"权限设置",width:"800px",onClose:J},{footer:o(()=>[t(u,{onClick:e[9]||(e[9]=a=>y.value=!1)},{default:o(()=>[...e[21]||(e[21]=[s("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:H,loading:h.value},{default:o(()=>[...e[22]||(e[22]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(oe,{ref_key:"permissionTreeRef",ref:w,data:D.value,props:{label:"name",children:"children"},"show-checkbox":"","node-key":"id","default-checked-keys":R.value,"check-strictly":""},null,8,["data","default-checked-keys"])]),_:1},8,["modelValue"])])}}},Ze=ne(Ne,[["__scopeId","data-v-9f34f461"]]);export{Ze as default};
