import{_ as ne}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                   *//* empty css                       *//* empty css                  *//* empty css                     *//* empty css                      *//* empty css                 */import{G as m,K as k,c as se,H as ie,r as re,o as c,a as E,b,d as o,w as n,L as B,M as w,T as g,J as de,N as ue,O as pe,a0 as me,P as ce,Q as ge,R as _e,f as u,I as fe,a1 as $,a2 as F,S as be,U as ve,V as he,h as ye,W as we,X as Ve,a3 as ze,_ as Ce,$ as Ie,a4 as ke}from"./index-25be2468.js";const Ee={class:"user-management"},Ue={class:"search-form"},xe={class:"button-group"},Ne={class:"table-container"},Te={class:"operation-buttons"},Se={class:"pagination"},je={class:"dialog-footer"},Pe={__name:"User",setup(De){const V=m(!1),U=m([]),_=m(!1),z=m(!1),h=m(),x=m([]),y=m([]),v=k({keyword:""}),r=k({page:1,limit:10,total:0}),l=k({id:null,username:"",realName:"",email:"",phone:"",organizationId:null,positionId:null,status:1}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名至少3位",trigger:"blur"}],realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:["blur","change"]}],organizationId:[{required:!0,message:"请选择所属组织",trigger:"change"}],positionId:[{required:!0,message:"请选择所属岗位",trigger:"change"}]},q=se(()=>l.id?"编辑用户":"新增用户"),f=async()=>{V.value=!0;try{const a={page:r.page,limit:r.limit,keyword:v.keyword},s=await(await fetch(`/api/users?${new URLSearchParams(a)}`)).json();U.value=s.data,r.total=s.total}catch(a){console.error("加载数据失败:",a),g.error("加载数据失败")}finally{V.value=!1}},C=()=>{r.page=1,f()},M=()=>{v.keyword="",C()},N=async()=>{try{const[a,e]=await Promise.all([fetch("/api/organizations/all"),fetch("/api/positions")]),[s,i]=await Promise.all([a.json(),e.json()]);x.value=s,i.value=i.data||i}catch(a){console.error("加载选项数据失败:",a)}},T=async a=>{try{const s=await(await fetch(`/api/positions?organizationId=${a}`)).json();y.value=s.data||s}catch(e){console.error("加载岗位数据失败:",e)}},J=()=>{I(),_.value=!0,N()},K=a=>{I(),Object.assign(l,{id:a.id,username:a.username,realName:a.real_name,email:a.email,phone:a.phone,organizationId:a.organization_id,positionId:a.position_id,status:a.status}),_.value=!0,N(),a.organization_id&&T(a.organization_id)},G=async a=>{try{await be.confirm(`确定要删除用户 "${a.username}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await fetch(`/api/users/${a.id}`,{method:"DELETE"});if(e.ok)g.success("删除成功"),f();else{const s=await e.json();g.error(s.message||"删除失败")}}catch(e){e!=="cancel"&&(console.error("删除失败:",e),g.error("删除失败"))}},A=async()=>{if(h.value)try{await h.value.validate(),z.value=!0;const a={username:l.username,real_name:l.realName,email:l.email,phone:l.phone,organization_id:l.organizationId,position_id:l.positionId,status:l.status};let e;if(l.id?e=await fetch(`/api/users/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):e=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e.ok)g.success(l.id?"更新成功":"创建成功"),_.value=!1,f();else{const s=await e.json();g.error(s.message||"操作失败")}}catch(a){console.error("提交失败:",a),g.error("操作失败")}finally{z.value=!1}},S=()=>{_.value=!1,I()},I=()=>{var a;(a=h.value)==null||a.resetFields(),Object.assign(l,{id:null,username:"",realName:"",email:"",phone:"",organizationId:null,positionId:null,status:1}),y.value=[]},H=a=>{l.positionId=null,a?T(a):y.value=[]},Q=a=>{r.limit=a,f()},W=a=>{r.page=a,f()};return ie(()=>{f()}),(a,e)=>{const s=ve,i=he,p=de,j=ue,X=re("Plus"),Y=ye,d=we,Z=Ve,ee=pe,oe=me,P=ke,D=ze,R=Ce,ae=Ie,te=ce,O=ge;return c(),E("div",Ee,[b("div",Ue,[o(j,{model:v,inline:""},{default:n(()=>[o(i,{label:"关键词"},{default:n(()=>[o(s,{modelValue:v.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>v.keyword=t),placeholder:"请输入用户名、姓名或邮箱",clearable:"",onKeyup:_e(C,["enter"])},null,8,["modelValue"])]),_:1}),o(i,null,{default:n(()=>[o(p,{type:"primary",onClick:C},{default:n(()=>[...e[11]||(e[11]=[u("搜索",-1)])]),_:1}),o(p,{onClick:M},{default:n(()=>[...e[12]||(e[12]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),b("div",xe,[o(p,{type:"primary",onClick:J},{default:n(()=>[o(Y,null,{default:n(()=>[o(X)]),_:1}),e[13]||(e[13]=u(" 新增用户 ",-1))]),_:1})]),b("div",Ne,[B((c(),w(ee,{data:U.value,border:"",style:{width:"100%"},"table-layout":"fixed"},{default:n(()=>[o(d,{prop:"id",label:"ID",width:"80","show-overflow-tooltip":""}),o(d,{prop:"username",label:"用户名",width:"120","show-overflow-tooltip":""}),o(d,{prop:"real_name",label:"真实姓名",width:"120","show-overflow-tooltip":""}),o(d,{prop:"email",label:"邮箱","min-width":"200","show-overflow-tooltip":""}),o(d,{prop:"phone",label:"手机号",width:"120","show-overflow-tooltip":""}),o(d,{prop:"org_name",label:"组织",width:"120","show-overflow-tooltip":""}),o(d,{prop:"position_name",label:"岗位",width:"120","show-overflow-tooltip":""}),o(d,{prop:"status",label:"状态",width:"80","show-overflow-tooltip":""},{default:n(({row:t})=>[o(Z,{type:t.status===1?"success":"danger"},{default:n(()=>[u(fe(t.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),o(d,{prop:"created_at",label:"创建时间",width:"160","show-overflow-tooltip":""}),o(d,{label:"操作",width:"200",fixed:"right"},{default:n(({row:t})=>[b("div",Te,[o(p,{size:"small",onClick:le=>K(t)},{default:n(()=>[...e[14]||(e[14]=[u("编辑",-1)])]),_:1},8,["onClick"]),o(p,{size:"small",type:"danger",onClick:le=>G(t)},{default:n(()=>[...e[15]||(e[15]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[O,V.value]]),b("div",Se,[o(oe,{"current-page":r.page,"onUpdate:currentPage":e[1]||(e[1]=t=>r.page=t),"page-size":r.limit,"onUpdate:pageSize":e[2]||(e[2]=t=>r.limit=t),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),o(te,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=t=>_.value=t),title:q.value,width:"600px",onClose:S},{footer:n(()=>[b("span",je,[o(p,{onClick:S},{default:n(()=>[...e[18]||(e[18]=[u("取消",-1)])]),_:1}),o(p,{type:"primary",onClick:A},{default:n(()=>[...e[19]||(e[19]=[u("确定",-1)])]),_:1})])]),default:n(()=>[B((c(),w(j,{ref_key:"formRef",ref:h,model:l,rules:L,"label-width":"100px"},{default:n(()=>[o(i,{label:"用户名",prop:"username"},{default:n(()=>[o(s,{modelValue:l.username,"onUpdate:modelValue":e[3]||(e[3]=t=>l.username=t),disabled:!!l.id},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"真实姓名",prop:"realName"},{default:n(()=>[o(s,{modelValue:l.realName,"onUpdate:modelValue":e[4]||(e[4]=t=>l.realName=t)},null,8,["modelValue"])]),_:1}),o(i,{label:"邮箱",prop:"email"},{default:n(()=>[o(s,{modelValue:l.email,"onUpdate:modelValue":e[5]||(e[5]=t=>l.email=t)},null,8,["modelValue"])]),_:1}),o(i,{label:"手机号",prop:"phone"},{default:n(()=>[o(s,{modelValue:l.phone,"onUpdate:modelValue":e[6]||(e[6]=t=>l.phone=t)},null,8,["modelValue"])]),_:1}),o(i,{label:"所属组织",prop:"organizationId"},{default:n(()=>[o(D,{modelValue:l.organizationId,"onUpdate:modelValue":e[7]||(e[7]=t=>l.organizationId=t),placeholder:"请选择组织",style:{width:"100%"},onChange:H},{default:n(()=>[(c(!0),E($,null,F(x.value,t=>(c(),w(P,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"所属岗位",prop:"positionId"},{default:n(()=>[o(D,{modelValue:l.positionId,"onUpdate:modelValue":e[8]||(e[8]=t=>l.positionId=t),placeholder:"请选择岗位",style:{width:"100%"},disabled:!l.organizationId},{default:n(()=>[(c(!0),E($,null,F(y.value,t=>(c(),w(P,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),o(i,{label:"状态",prop:"status"},{default:n(()=>[o(ae,{modelValue:l.status,"onUpdate:modelValue":e[9]||(e[9]=t=>l.status=t)},{default:n(()=>[o(R,{label:1},{default:n(()=>[...e[16]||(e[16]=[u("启用",-1)])]),_:1}),o(R,{label:0},{default:n(()=>[...e[17]||(e[17]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[O,z.value]])]),_:1},8,["modelValue","title"])])}}},Ke=ne(Pe,[["__scopeId","data-v-08e2db55"]]);export{Ke as default};
