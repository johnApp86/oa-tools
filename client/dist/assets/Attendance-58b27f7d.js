import{_ as we}from"./_plugin-vue_export-helper-0b6f8918.js";/* empty css                     *//* empty css                   *//* empty css                    *//* empty css                 *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                             *//* empty css                */import{G as V,c as D,K as L,H as Ce,o as T,a as Y,d as t,w as l,T as m,a6 as xe,P as Le,b as o,g as I,f as r,I as c,a1 as Te,a2 as Ue,L as Z,M,R as Ee,S as ee,h as Se,J as ze,a9 as De,a4 as Ae,a3 as Be,V as Pe,a8 as Fe,N as Ie,W as Me,O as Oe,a0 as Re,a7 as je,U as $e,X as qe,Q as Ne,z as te,x as He}from"./index-4e5dc47e.js";import{i as ae,j as Ke,k as le,l as We}from"./hr-9ba5c14e.js";import{g as Ge}from"./user-ad827ea9.js";import"./request-3883ec4c.js";const Je={class:"attendance-management"},Qe={class:"tab-content"},Xe={class:"button-group"},Ye={class:"today-status"},Ze={class:"status-info"},et={class:"status-item"},tt={class:"value"},at={class:"status-item"},lt={class:"value"},st={class:"status-item"},ot={class:"value"},nt={class:"search-form"},dt={class:"table-container"},rt={class:"pagination"},it={class:"tab-content"},ut={class:"search-form"},ct={class:"button-group"},pt={class:"leave-stats"},_t={class:"leave-stat-card"},mt={class:"leave-stat-value"},vt={class:"leave-stat-card"},ft={class:"leave-stat-value"},gt={class:"leave-stat-card"},bt={class:"leave-stat-value"},yt={class:"leave-stat-card"},kt={class:"leave-stat-value"},Vt={class:"table-container"},ht={class:"leave-days"},wt=["title"],Ct={class:"operation-buttons"},xt={class:"pagination"},Lt={__name:"Attendance",setup(Tt){const O=V("attendance"),A=V(!1),R=V([]),b=V({}),j=V([]),B=V(!1),C=V([]),x=V(!1),U=D(()=>{const s=C.value.length,e=C.value.filter(g=>g.status===1).length,i=C.value.filter(g=>g.status===2).length,d=C.value.filter(g=>g.status===3).length;return{total:s,pending:e,approved:i,rejected:d}}),v=L({user_id:"",date_start:"",date_end:""}),f=L({keyword:"",type:"",status:""}),y=L({page:1,limit:10,total:0}),k=L({page:1,limit:10,total:0}),p=L({type:"",start_date:"",end_date:"",reason:"",emergency_contact:""}),se={type:[{required:!0,message:"请选择请假类型",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],reason:[{required:!0,message:"请输入请假原因",trigger:"blur"}]},$=V(),q=D(()=>!!b.value.checkin_time),oe=D(()=>!!b.value.checkout_time),ne=D(()=>b.value.checkin_time&&b.value.checkout_time?H(b.value.checkin_time,b.value.checkout_time):0),de=s=>({annual:"年假",sick:"病假",personal:"事假",compensatory:"调休",other:"其他"})[s]||s,re=s=>({1:"info",2:"success",3:"danger"})[s]||"info",ie=s=>({1:"待审核",2:"已通过",3:"已拒绝"})[s]||"待审核",N=s=>s?new Date(s).toLocaleString():"",H=(s,e)=>{if(!s||!e)return 0;const i=new Date(s),g=new Date(e)-i;return Math.round(g/(1e3*60*60)*100)/100},ue=(s,e)=>{if(!s||!e)return 0;const i=new Date(s),d=new Date(e),g=Math.abs(d-i);return Math.ceil(g/(1e3*60*60*24))+1},ce=s=>{s==="attendance"?(h(),E()):s==="leave"&&w()},h=async()=>{A.value=!0;try{const s={page:y.page,limit:y.limit,...v},e=await ae(s);R.value=e.data,y.total=e.total}catch{m.error("加载数据失败")}finally{A.value=!1}},E=async()=>{try{const s=new Date().toISOString().split("T")[0],i=await ae({date_start:s,date_end:s,limit:1});i.data&&i.data.length>0?b.value=i.data[0]:b.value={}}catch(s){console.error("加载今日考勤失败:",s)}},w=async()=>{B.value=!0;try{const s={page:k.page,limit:k.limit,...f},e=await Ke(s);C.value=e.data,k.total=e.total}catch{m.error("加载数据失败")}finally{B.value=!1}},pe=()=>{v.user_id="",v.date_start="",v.date_end="",y.page=1,h()},_e=()=>{f.keyword="",f.type="",f.status="",k.page=1,w()},me=async()=>{try{await ee.prompt("请输入签到地点","签到",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"请输入签到地点"});const s=arguments[0].value||"办公室";await le({user_id:1,type:"checkin",location:s}),m.success("签到成功"),E(),h()}catch(s){s!=="cancel"&&m.error("签到失败")}},ve=async()=>{try{await ee.prompt("请输入签退地点","签退",{confirmButtonText:"确认",cancelButtonText:"取消",inputPlaceholder:"请输入签退地点"});const s=arguments[0].value||"办公室";await le({user_id:1,type:"checkout",location:s}),m.success("签退成功"),E(),h()}catch(s){s!=="cancel"&&m.error("签退失败")}},fe=async()=>{try{await $.value.validate(),await We({...p,user_id:1}),m.success("申请提交成功"),x.value=!1,ge(),w()}catch{m.error("申请提交失败")}},ge=()=>{Object.assign(p,{type:"",start_date:"",end_date:"",reason:"",emergency_contact:""})},be=s=>{m.info("查看请假详情功能待实现")},K=async(s,e)=>{try{m.success("状态更新成功"),w()}catch{m.error("状态更新失败")}},ye=async()=>{try{const s=await Ge();j.value=s.data||s}catch{m.error("加载基础数据失败")}};return Ce(()=>{h(),E(),ye()}),(s,e)=>{const i=Se,d=ze,g=De,u=Ae,S=Be,_=Pe,z=Fe,P=Ie,n=Me,W=Oe,G=Re,J=je,F=$e,ke=qe,Ve=xe,he=Le,Q=Ne;return T(),Y("div",Je,[t(Ve,{modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=a=>O.value=a),onTabChange:ce},{default:l(()=>[t(J,{label:"考勤管理",name:"attendance"},{default:l(()=>[o("div",Qe,[o("div",Xe,[t(d,{type:"success",onClick:me,disabled:q.value},{default:l(()=>[t(i,null,{default:l(()=>[t(I(te))]),_:1}),e[19]||(e[19]=r(" 签到 ",-1))]),_:1},8,["disabled"]),t(d,{type:"warning",onClick:ve,disabled:!q.value||oe.value},{default:l(()=>[t(i,null,{default:l(()=>[t(I(te))]),_:1}),e[20]||(e[20]=r(" 签退 ",-1))]),_:1},8,["disabled"])]),o("div",Ye,[t(g,null,{header:l(()=>[...e[21]||(e[21]=[o("span",null,"今日考勤状态",-1)])]),default:l(()=>[o("div",Ze,[o("div",et,[e[22]||(e[22]=o("span",{class:"label"},"签到时间：",-1)),o("span",tt,c(b.value.checkin_time||"未签到"),1)]),o("div",at,[e[23]||(e[23]=o("span",{class:"label"},"签退时间：",-1)),o("span",lt,c(b.value.checkout_time||"未签退"),1)]),o("div",st,[e[24]||(e[24]=o("span",{class:"label"},"工作时长：",-1)),o("span",ot,c(ne.value)+"小时",1)])])]),_:1})]),o("div",nt,[t(P,{model:v,inline:""},{default:l(()=>[t(_,{label:"员工"},{default:l(()=>[t(S,{modelValue:v.user_id,"onUpdate:modelValue":e[0]||(e[0]=a=>v.user_id=a),placeholder:"选择员工",clearable:""},{default:l(()=>[(T(!0),Y(Te,null,Ue(j.value,a=>(T(),M(u,{key:a.id,label:a.real_name||a.username,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"开始日期"},{default:l(()=>[t(z,{modelValue:v.date_start,"onUpdate:modelValue":e[1]||(e[1]=a=>v.date_start=a),type:"date",placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),t(_,{label:"结束日期"},{default:l(()=>[t(z,{modelValue:v.date_end,"onUpdate:modelValue":e[2]||(e[2]=a=>v.date_end=a),type:"date",placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(d,{type:"primary",onClick:h},{default:l(()=>[...e[25]||(e[25]=[r("搜索",-1)])]),_:1}),t(d,{onClick:pe},{default:l(()=>[...e[26]||(e[26]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),o("div",dt,[Z((T(),M(W,{data:R.value,stripe:"",border:""},{default:l(()=>[t(n,{prop:"user_name",label:"员工姓名"}),t(n,{prop:"position_name",label:"岗位"}),t(n,{prop:"date",label:"日期"}),t(n,{prop:"checkin_time",label:"签到时间"},{default:l(({row:a})=>[r(c(a.checkin_time?N(a.checkin_time):"未签到"),1)]),_:1}),t(n,{prop:"checkout_time",label:"签退时间"},{default:l(({row:a})=>[r(c(a.checkout_time?N(a.checkout_time):"未签退"),1)]),_:1}),t(n,{label:"工作时长"},{default:l(({row:a})=>[r(c(H(a.checkin_time,a.checkout_time))+"小时 ",1)]),_:1}),t(n,{prop:"checkin_location",label:"签到地点"}),t(n,{prop:"checkout_location",label:"签退地点"})]),_:1},8,["data"])),[[Q,A.value]])]),o("div",rt,[t(G,{"current-page":y.page,"onUpdate:currentPage":e[3]||(e[3]=a=>y.page=a),"page-size":y.limit,"onUpdate:pageSize":e[4]||(e[4]=a=>y.limit=a),total:y.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:h,onCurrentChange:h},null,8,["current-page","page-size","total"])])])]),_:1}),t(J,{label:"请假管理",name:"leave"},{default:l(()=>[o("div",it,[o("div",ut,[t(P,{model:f,inline:""},{default:l(()=>[t(_,{label:"关键词"},{default:l(()=>[t(F,{modelValue:f.keyword,"onUpdate:modelValue":e[5]||(e[5]=a=>f.keyword=a),placeholder:"搜索姓名或邮箱",clearable:"",onKeyup:Ee(w,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{label:"请假类型"},{default:l(()=>[t(S,{modelValue:f.type,"onUpdate:modelValue":e[6]||(e[6]=a=>f.type=a),placeholder:"选择请假类型",clearable:""},{default:l(()=>[t(u,{label:"年假",value:"annual"}),t(u,{label:"病假",value:"sick"}),t(u,{label:"事假",value:"personal"}),t(u,{label:"调休",value:"compensatory"}),t(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"状态"},{default:l(()=>[t(S,{modelValue:f.status,"onUpdate:modelValue":e[7]||(e[7]=a=>f.status=a),placeholder:"选择状态",clearable:""},{default:l(()=>[t(u,{label:"待审核",value:"1"}),t(u,{label:"已通过",value:"2"}),t(u,{label:"已拒绝",value:"3"})]),_:1},8,["modelValue"])]),_:1}),t(_,null,{default:l(()=>[t(d,{type:"primary",onClick:w},{default:l(()=>[...e[27]||(e[27]=[r("搜索",-1)])]),_:1}),t(d,{onClick:_e},{default:l(()=>[...e[28]||(e[28]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),o("div",ct,[t(d,{type:"primary",onClick:e[8]||(e[8]=a=>x.value=!0)},{default:l(()=>[t(i,null,{default:l(()=>[t(I(He))]),_:1}),e[29]||(e[29]=r(" 申请请假 ",-1))]),_:1})]),o("div",pt,[o("div",_t,[o("div",mt,c(U.value.total),1),e[30]||(e[30]=o("div",{class:"leave-stat-label"},"总申请数",-1))]),o("div",vt,[o("div",ft,c(U.value.pending),1),e[31]||(e[31]=o("div",{class:"leave-stat-label"},"待审核",-1))]),o("div",gt,[o("div",bt,c(U.value.approved),1),e[32]||(e[32]=o("div",{class:"leave-stat-label"},"已通过",-1))]),o("div",yt,[o("div",kt,c(U.value.rejected),1),e[33]||(e[33]=o("div",{class:"leave-stat-label"},"已拒绝",-1))])]),o("div",Vt,[Z((T(),M(W,{data:C.value,stripe:"",border:""},{default:l(()=>[t(n,{prop:"user_name",label:"员工姓名"}),t(n,{prop:"position_name",label:"岗位"}),t(n,{prop:"type",label:"请假类型"},{default:l(({row:a})=>[r(c(de(a.type)),1)]),_:1}),t(n,{prop:"start_date",label:"开始日期"}),t(n,{prop:"end_date",label:"结束日期"}),t(n,{label:"请假天数"},{default:l(({row:a})=>[o("span",ht,c(ue(a.start_date,a.end_date))+"天",1)]),_:1}),t(n,{prop:"reason",label:"请假原因"},{default:l(({row:a})=>[o("span",{class:"leave-reason",title:a.reason},c(a.reason),9,wt)]),_:1}),t(n,{prop:"status",label:"状态"},{default:l(({row:a})=>[t(ke,{type:re(a.status)},{default:l(()=>[r(c(ie(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(n,{prop:"created_at",label:"申请时间"}),t(n,{label:"操作",width:"250"},{default:l(({row:a})=>[o("div",Ct,[t(d,{size:"small",onClick:X=>be(a)},{default:l(()=>[...e[34]||(e[34]=[r("查看详情",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"success",onClick:X=>K(a,2)},{default:l(()=>[...e[35]||(e[35]=[r("通过",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",onClick:X=>K(a,3)},{default:l(()=>[...e[36]||(e[36]=[r("拒绝",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Q,B.value]])]),o("div",xt,[t(G,{"current-page":k.page,"onUpdate:currentPage":e[9]||(e[9]=a=>k.page=a),"page-size":k.limit,"onUpdate:pageSize":e[10]||(e[10]=a=>k.limit=a),total:k.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])])])]),_:1})]),_:1},8,["modelValue"]),t(he,{modelValue:x.value,"onUpdate:modelValue":e[18]||(e[18]=a=>x.value=a),title:"申请请假",width:"600px"},{footer:l(()=>[t(d,{onClick:e[17]||(e[17]=a=>x.value=!1)},{default:l(()=>[...e[37]||(e[37]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:fe},{default:l(()=>[...e[38]||(e[38]=[r("提交申请",-1)])]),_:1})]),default:l(()=>[t(P,{model:p,rules:se,ref_key:"leaveFormRef",ref:$,"label-width":"100px"},{default:l(()=>[t(_,{label:"请假类型",prop:"type"},{default:l(()=>[t(S,{modelValue:p.type,"onUpdate:modelValue":e[12]||(e[12]=a=>p.type=a),placeholder:"选择请假类型",style:{width:"100%"}},{default:l(()=>[t(u,{label:"年假",value:"annual"}),t(u,{label:"病假",value:"sick"}),t(u,{label:"事假",value:"personal"}),t(u,{label:"调休",value:"compensatory"}),t(u,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"开始日期",prop:"start_date"},{default:l(()=>[t(z,{modelValue:p.start_date,"onUpdate:modelValue":e[13]||(e[13]=a=>p.start_date=a),type:"date",placeholder:"选择开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(_,{label:"结束日期",prop:"end_date"},{default:l(()=>[t(z,{modelValue:p.end_date,"onUpdate:modelValue":e[14]||(e[14]=a=>p.end_date=a),type:"date",placeholder:"选择结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(_,{label:"请假原因",prop:"reason"},{default:l(()=>[t(F,{modelValue:p.reason,"onUpdate:modelValue":e[15]||(e[15]=a=>p.reason=a),type:"textarea",rows:4,placeholder:"请输入请假原因"},null,8,["modelValue"])]),_:1}),t(_,{label:"紧急联系人"},{default:l(()=>[t(F,{modelValue:p.emergency_contact,"onUpdate:modelValue":e[16]||(e[16]=a=>p.emergency_contact=a),placeholder:"请输入紧急联系人及电话"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},$t=we(Lt,[["__scopeId","data-v-dc77f748"]]);export{$t as default};
